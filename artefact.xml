<?xml version="1.0"?><artefact xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="artefact.xsd" name="WooCommerce Product Calculator" slug="woo-product-calculator" type="code-package" schemaVersion="2">
  <file path="readme.txt">
    <description>This file contains the readme information for the block. It is used to provide information about the block, its usage, and any other relevant details.</description>
    <content><![CDATA[=== WooCommerce Product Calculator ===

Contributors:      WordPress Telex
Tags:              block, woocommerce, calculator, product, printing
Tested up to:      6.8
Stable tag:        0.1.0
License:           GPLv2 or later
License URI:       https://www.gnu.org/licenses/gpl-2.0.html

A dynamic product calculator for WooCommerce that enables custom field configuration for printing and manufacturing products.

== Description ==

WooCommerce Product Calculator is a powerful block that transforms product pages into interactive configuration tools. Perfect for printing services, custom manufacturing, or any business requiring detailed product specifications from customers.

**Seamless WooCommerce Integration:**

* Adds products with custom configurations directly to cart
* Displays all calculator inputs in cart, checkout, and order details
* Includes calculator data in order emails
* Prevents cart items with different configurations from merging
* Full compatibility with WooCommerce's standard checkout flow

**Key Features:**

* **Dynamic Field Configuration** - Create custom fields per product with support for text, number, dropdown, radio buttons, and file uploads
* **Multi-Step Form Navigation** - Break complex configurations into logical steps for better user experience
* **Complete Cart Integration** - Customer inputs automatically saved to cart items and order metadata
* **Conditional Logic** - Show/hide fields based on previous selections
* **Real-Time Price Calculation** - Calculate prices based on dimensions, quantity, and options
* **File Upload Support** - Accept artwork files with validation (PDF, PNG, JPG, AI, EPS)
* **Mobile Responsive** - Fully optimized for mobile devices
* **Admin-Friendly** - Intuitive interface for managing calculator fields
* **Email Integration** - Calculator data included in all WooCommerce order emails

**Perfect For:**

* Printing services (labels, stickers, business cards)
* Custom manufacturing
* Made-to-order products
* Products requiring detailed specifications
* Any business needing customer input before purchase

**How WooCommerce Integration Works:**

1. Customer fills out calculator fields
2. Clicks "Add to Cart" (AJAX submission)
3. Product added with all calculator data stored as cart item metadata
4. Data displays in cart with nice formatting
5. Data carries through to checkout
6. Saved to order items on order completion
7. Visible in admin order details
8. Included in customer and admin order emails

**Field Types Supported:**

* Text input
* Number input
* Dropdown select
* Radio buttons
* Checkbox groups
* File upload
* Textarea

**Built-In Templates:**

The block includes pre-configured templates for common use cases:
* Label/Sticker Printing
* Business Card Printing
* Banner Printing
* Custom Product Quote

== Installation ==

1. Upload the plugin files to the `/wp-content/plugins/woo-product-calculator` directory, or install the plugin through the WordPress plugins screen directly.
2. Activate the plugin through the 'Plugins' screen in WordPress
3. Ensure WooCommerce is installed and activated
4. Add the "WooCommerce Product Calculator" block to any product page
5. Configure your calculator fields in the block settings
6. Test by adding a product to cart and checking that data appears correctly

== Frequently Asked Questions ==

= Does this work with any WooCommerce product type? =

Yes, the calculator works with simple products, variable products, and custom product types.

= Will calculator data show in my order emails? =

Yes! All calculator inputs are automatically included in WooCommerce order emails to both customers and admins.

= Can customers see their calculator inputs in the cart? =

Absolutely. All inputs display clearly in the cart, checkout, and order confirmation pages.

= Will items with different calculator data merge in the cart? =

No. The plugin prevents cart items with different calculator configurations from merging, keeping each unique configuration as a separate line item.

= Can I add custom price calculations? =

Yes, the block includes a price calculation system that you can configure based on field values.

= Is file upload secure? =

Yes, files are validated for type and size, uploaded to WordPress media library with proper permissions.

= How do I access calculator data in admin orders? =

Calculator data appears as order item metadata in the admin order details page, clearly labeled with each field name and value.

== Screenshots ==

1. Multi-step calculator interface on product page
2. Admin interface for configuring calculator fields
3. Calculator fields in the block editor
4. Customer inputs displayed in cart
5. Order details showing calculator data
6. Calculator data in order emails

== Changelog ==

= 0.1.0 =
* Initial release
* Multi-step form navigation
* Dynamic field types
* Full WooCommerce cart integration
* Order item metadata support
* Email integration
* File upload support
* Conditional logic
* Price calculation
* Mobile responsive design
* Prevents cart item merging for unique configurations

== Upgrade Notice ==

= 0.1.0 =
Initial release of WooCommerce Product Calculator with complete cart and order integration

== Additional Information ==

**Requirements:**
* WordPress 6.0 or higher
* WooCommerce 7.0 or higher
* PHP 7.4 or higher

**Browser Support:**
* Chrome (latest 2 versions)
* Firefox (latest 2 versions)
* Safari (latest 2 versions)
* Edge (latest 2 versions)

**Developer Features:**
* Extensive hook system for customization
* Filter support for field types
* Action hooks for calculation logic
* Clean, documented code
* Modular structure for easy extension
* WooCommerce standard hooks and filters]]></content>
  </file>
  <file path="woo-product-calculator.php">
    <description>This file contains the block registration code in the form of a single block plugin. Any other plugin related functionality should be added to this file. All block rendering functionality should go to the `render.php` file.</description>
    <content><![CDATA[<?php
/**
 * Plugin Name:       WooCommerce Product Calculator
 * Plugin URI:        https://wordpress.org/plugins/woo-product-calculator
 * Description:       A dynamic product calculator for WooCommerce that enables custom field configuration for printing and manufacturing products.
 * Version:           0.1.0
 * Requires at least: 6.0
 * Requires PHP:      7.4
 * Author:            WordPress Telex
 * License:           GPLv2 or later
 * License URI:       https://www.gnu.org/licenses/gpl-2.0.html
 * Text Domain:       woo-product-calculator
 * Domain Path:       /languages
 *
 * @package TelexWooProductCalculator
 */

if ( ! defined( 'ABSPATH' ) ) {
	exit;
}

/**
 * Check if WooCommerce is active
 */
if ( ! function_exists( 'telex_woo_calculator_check_woocommerce' ) ) {
	function telex_woo_calculator_check_woocommerce() {
		if ( ! class_exists( 'WooCommerce' ) ) {
			add_action( 'admin_notices', 'telex_woo_calculator_woocommerce_notice' );
			return false;
		}
		return true;
	}
}

/**
 * Display admin notice if WooCommerce is not active
 */
if ( ! function_exists( 'telex_woo_calculator_woocommerce_notice' ) ) {
	function telex_woo_calculator_woocommerce_notice() {
		?>
		<div class="notice notice-error">
			<p><?php esc_html_e( 'WooCommerce Product Calculator requires WooCommerce to be installed and active.', 'woo-product-calculator' ); ?></p>
		</div>
		<?php
	}
}

/**
 * Registers the block using the metadata loaded from the `block.json` file.
 */
if ( ! function_exists( 'telex_woo_calculator_block_init' ) ) {
	function telex_woo_calculator_block_init() {
		if ( ! telex_woo_calculator_check_woocommerce() ) {
			return;
		}
		
		register_block_type( 
			__DIR__ . '/build/',
			array(
				'render_callback' => 'telex_woo_calculator_render_callback',
			)
		);
	}
}
add_action( 'init', 'telex_woo_calculator_block_init' );

/**
 * Render callback function
 */
if ( ! function_exists( 'telex_woo_calculator_render_callback' ) ) {
	function telex_woo_calculator_render_callback( $attributes ) {
		// Enqueue the view script with inline data
		$asset_file = include( __DIR__ . '/build/view.asset.php' );
		
		wp_enqueue_script(
			'telex-woo-product-calculator-view',
			plugins_url( 'build/view.js', __FILE__ ),
			$asset_file['dependencies'],
			$asset_file['version'],
			true
		);
		
		wp_localize_script(
			'telex-woo-product-calculator-view',
			'wooCalculatorData',
			array(
				'ajaxUrl' => admin_url( 'admin-ajax.php' ),
				'nonce' => wp_create_nonce( 'woo-calculator-nonce' ),
			)
		);
		
		// Load the render template
		require __DIR__ . '/build/render.php';
	}
}

/**
 * Handle AJAX request to add product to cart with calculator data
 */
if ( ! function_exists( 'telex_woo_calculator_add_to_cart' ) ) {
	function telex_woo_calculator_add_to_cart() {
		check_ajax_referer( 'woo-calculator-nonce', 'nonce' );
		
		$product_id = isset( $_POST['product_id'] ) ? absint( $_POST['product_id'] ) : 0;
		$quantity = isset( $_POST['quantity'] ) ? absint( $_POST['quantity'] ) : 1;
		$calculator_data = isset( $_POST['calculator_data'] ) ? json_decode( stripslashes( $_POST['calculator_data'] ), true ) : array();
		
		if ( ! $product_id ) {
			wp_send_json_error( array( 'message' => __( 'Invalid product ID', 'woo-product-calculator' ) ) );
		}
		
		$product = wc_get_product( $product_id );
		if ( ! $product ) {
			wp_send_json_error( array( 'message' => __( 'Product not found', 'woo-product-calculator' ) ) );
		}
		
		$cart_item_key = WC()->cart->add_to_cart( 
			$product_id, 
			$quantity, 
			0, 
			array(), 
			array( 'calculator_data' => $calculator_data )
		);
		
		if ( $cart_item_key ) {
			do_action( 'woocommerce_add_to_cart', $cart_item_key, $product_id, $quantity, 0, array(), array( 'calculator_data' => $calculator_data ) );
			
			wp_send_json_success( array(
				'message' => __( 'Product added to cart successfully!', 'woo-product-calculator' ),
				'cart_url' => wc_get_cart_url(),
				'cart_count' => WC()->cart->get_cart_contents_count(),
			) );
		} else {
			wp_send_json_error( array( 'message' => __( 'Failed to add product to cart', 'woo-product-calculator' ) ) );
		}
	}
}
add_action( 'wp_ajax_woo_calculator_add_to_cart', 'telex_woo_calculator_add_to_cart' );
add_action( 'wp_ajax_nopriv_woo_calculator_add_to_cart', 'telex_woo_calculator_add_to_cart' );

/**
 * Display calculator data in cart with better formatting
 */
if ( ! function_exists( 'telex_woo_calculator_cart_item_data' ) ) {
	function telex_woo_calculator_cart_item_data( $item_data, $cart_item ) {
		if ( isset( $cart_item['calculator_data'] ) && is_array( $cart_item['calculator_data'] ) ) {
			foreach ( $cart_item['calculator_data'] as $key => $value ) {
				if ( empty( $value ) ) {
					continue;
				}
				
				if ( is_array( $value ) ) {
					$value = implode( ', ', $value );
				}
				
				if ( filter_var( $value, FILTER_VALIDATE_URL ) ) {
					$filename = basename( $value );
					$value = '<a href="' . esc_url( $value ) . '" target="_blank">' . esc_html( $filename ) . '</a>';
				}
				
				$label = ucwords( str_replace( array( '_', '-' ), ' ', $key ) );
				
				$item_data[] = array(
					'key'     => $label,
					'value'   => $value,
					'display' => '',
				);
			}
		}
		
		return $item_data;
	}
}
add_filter( 'woocommerce_get_item_data', 'telex_woo_calculator_cart_item_data', 10, 2 );

/**
 * Add calculator data to order items
 */
if ( ! function_exists( 'telex_woo_calculator_add_order_item_meta' ) ) {
	function telex_woo_calculator_add_order_item_meta( $item, $cart_item_key, $values, $order ) {
		if ( isset( $values['calculator_data'] ) && is_array( $values['calculator_data'] ) ) {
			foreach ( $values['calculator_data'] as $key => $value ) {
				if ( empty( $value ) ) {
					continue;
				}
				
				if ( is_array( $value ) ) {
					$value = implode( ', ', $value );
				}
				
				$label = ucwords( str_replace( array( '_', '-' ), ' ', $key ) );
				
				$item->add_meta_data( $label, $value, true );
			}
		}
	}
}
add_action( 'woocommerce_checkout_create_order_line_item', 'telex_woo_calculator_add_order_item_meta', 10, 4 );

/**
 * Display calculator data in order emails
 */
if ( ! function_exists( 'telex_woo_calculator_order_item_meta' ) ) {
	function telex_woo_calculator_order_item_meta( $item_id, $item, $order, $plain_text ) {
		$metadata = $item->get_meta_data();
		
		if ( ! empty( $metadata ) ) {
			foreach ( $metadata as $meta ) {
				$data = $meta->get_data();
				if ( isset( $data['key'] ) && isset( $data['value'] ) ) {
					if ( ! str_starts_with( $data['key'], '_' ) ) {
						if ( $plain_text ) {
							echo "\n" . esc_html( $data['key'] ) . ': ' . esc_html( $data['value'] );
						} else {
							echo '<br><small>' . esc_html( $data['key'] ) . ': ' . wp_kses_post( $data['value'] ) . '</small>';
						}
					}
				}
			}
		}
	}
}
add_action( 'woocommerce_order_item_meta_end', 'telex_woo_calculator_order_item_meta', 10, 4 );

/**
 * Make cart item data unique to prevent merging
 */
if ( ! function_exists( 'telex_woo_calculator_cart_item_data_unique' ) ) {
	function telex_woo_calculator_cart_item_data_unique( $cart_item_data, $product_id ) {
		if ( isset( $cart_item_data['calculator_data'] ) ) {
			$cart_item_data['unique_key'] = md5( wp_json_encode( $cart_item_data['calculator_data'] ) );
		}
		return $cart_item_data;
	}
}
add_filter( 'woocommerce_add_cart_item_data', 'telex_woo_calculator_cart_item_data_unique', 10, 2 );

/**
 * Handle file upload via AJAX
 */
if ( ! function_exists( 'telex_woo_calculator_upload_file' ) ) {
	function telex_woo_calculator_upload_file() {
		check_ajax_referer( 'woo-calculator-nonce', 'nonce' );
		
		if ( ! function_exists( 'wp_handle_upload' ) ) {
			require_once( ABSPATH . 'wp-admin/includes/file.php' );
		}
		
		$allowed_types = array( 'pdf', 'png', 'jpg', 'jpeg', 'ai', 'eps' );
		$max_size = 10 * 1024 * 1024;
		
		if ( empty( $_FILES['file'] ) ) {
			wp_send_json_error( array( 'message' => __( 'No file uploaded', 'woo-product-calculator' ) ) );
		}
		
		$file = $_FILES['file'];
		$file_ext = strtolower( pathinfo( $file['name'], PATHINFO_EXTENSION ) );
		
		if ( ! in_array( $file_ext, $allowed_types ) ) {
			wp_send_json_error( array( 'message' => __( 'Invalid file type. Allowed: PDF, PNG, JPG, AI, EPS', 'woo-product-calculator' ) ) );
		}
		
		if ( $file['size'] > $max_size ) {
			wp_send_json_error( array( 'message' => __( 'File size exceeds 10MB limit', 'woo-product-calculator' ) ) );
		}
		
		$upload_overrides = array( 'test_form' => false );
		$uploaded_file = wp_handle_upload( $file, $upload_overrides );
		
		if ( isset( $uploaded_file['error'] ) ) {
			wp_send_json_error( array( 'message' => $uploaded_file['error'] ) );
		}
		
		wp_send_json_success( array(
			'url' => $uploaded_file['url'],
			'file' => $uploaded_file['file'],
			'name' => basename( $uploaded_file['file'] ),
		) );
	}
}
add_action( 'wp_ajax_woo_calculator_upload_file', 'telex_woo_calculator_upload_file' );
add_action( 'wp_ajax_nopriv_woo_calculator_upload_file', 'telex_woo_calculator_upload_file' );]]></content>
  </file>
  <file path="src/block.json">
    <description>This file contains metadata about the block including its name, title, category, icon, and other properties.</description>
    <content><![CDATA[{
	"$schema": "https://schemas.wp.org/trunk/block.json",
	"apiVersion": 3,
	"name": "telex/woo-product-calculator",
	"version": "0.1.0",
	"title": "WooCommerce Product Calculator",
	"category": "woocommerce",
	"icon": "calculator",
	"description": "A dynamic product calculator for WooCommerce with customizable fields and multi-step navigation.",
	"example": {
		"attributes": {
			"calculatorTitle": "Configure Your Labels",
			"productId": 0,
			"steps": [
				{
					"title": "Dimensions",
					"fields": [
						{
							"type": "number",
							"label": "Width (mm)",
							"name": "width",
							"required": true
						},
						{
							"type": "number",
							"label": "Height (mm)",
							"name": "height",
							"required": true
						}
					]
				}
			]
		}
	},
	"attributes": {
		"calculatorTitle": {
			"type": "string",
			"default": "Configure Your Product"
		},
		"productId": {
			"type": "number",
			"default": 0
		},
		"steps": {
			"type": "array",
			"default": [
				{
					"title": "Product Details",
					"fields": []
				}
			]
		},
		"priceCalculation": {
			"type": "object",
			"default": {
				"enabled": false,
				"formula": ""
			}
		},
		"buttonText": {
			"type": "string",
			"default": "Add to Cart"
		}
	},
	"supports": {
		"html": false,
		"align": true,
		"spacing": {
			"margin": true,
			"padding": true
		}
	},
	"textdomain": "woo-product-calculator",
	"editorScript": "file:./index.js",
	"editorStyle": "file:./index.css",
	"style": "file:./style-index.css"
}]]></content>
  </file>
  <file path="src/index.js">
    <description>This file registers the block, specifies the edit and save functions, and loads the block's metadata</description>
    <content><![CDATA[
import { registerBlockType } from '@wordpress/blocks';
import './style.scss';
import Edit from './edit';
import metadata from './block.json';

registerBlockType( metadata.name, {
	edit: Edit,
} );
]]></content>
  </file>
  <file path="src/edit.js">
    <description>This file contains the edit function for the block which is responsible for rendering the block in the editor.</description>
    <content><![CDATA[
import { __ } from '@wordpress/i18n';
import { useBlockProps, InspectorControls } from '@wordpress/block-editor';
import { 
	PanelBody, 
	TextControl, 
	Button, 
	SelectControl,
	ToggleControl,
	__experimentalNumberControl as NumberControl,
	Notice
} from '@wordpress/components';
import { useState, useEffect } from '@wordpress/element';
import { useSelect } from '@wordpress/data';
import { plus, trash } from '@wordpress/icons';
import './editor.scss';

export default function Edit( { attributes, setAttributes } ) {
	const { calculatorTitle, productId, steps, priceCalculation, buttonText } = attributes;
	const [ selectedStepIndex, setSelectedStepIndex ] = useState( 0 );
	const [ selectedFieldIndex, setSelectedFieldIndex ] = useState( null );

	// Fetch WooCommerce products
	const products = useSelect( ( select ) => {
		const { getEntityRecords } = select( 'core' );
		return getEntityRecords( 'postType', 'product', { per_page: -1 } ) || [];
	}, [] );

	const productOptions = [
		{ label: __( 'Select a product...', 'woo-product-calculator' ), value: 0 },
		...products.map( product => ( {
			label: product.title.rendered,
			value: product.id
		} ) )
	];

	const selectedProduct = products.find( p => p.id === productId );

	const blockProps = useBlockProps( {
		className: 'woo-calculator-editor',
	} );

	const fieldTypes = [
		{ label: __( 'Text', 'woo-product-calculator' ), value: 'text' },
		{ label: __( 'Number', 'woo-product-calculator' ), value: 'number' },
		{ label: __( 'Dropdown', 'woo-product-calculator' ), value: 'select' },
		{ label: __( 'Radio', 'woo-product-calculator' ), value: 'radio' },
		{ label: __( 'Checkbox', 'woo-product-calculator' ), value: 'checkbox' },
		{ label: __( 'Textarea', 'woo-product-calculator' ), value: 'textarea' },
		{ label: __( 'File Upload', 'woo-product-calculator' ), value: 'file' },
	];

	const addStep = () => {
		const newSteps = [ ...steps, { title: __( 'New Step', 'woo-product-calculator' ), fields: [] } ];
		setAttributes( { steps: newSteps } );
		setSelectedStepIndex( newSteps.length - 1 );
	};

	const updateStep = ( index, key, value ) => {
		const newSteps = [ ...steps ];
		newSteps[ index ][ key ] = value;
		setAttributes( { steps: newSteps } );
	};

	const removeStep = ( index ) => {
		const newSteps = steps.filter( ( _, i ) => i !== index );
		setAttributes( { steps: newSteps } );
		if ( selectedStepIndex >= newSteps.length ) {
			setSelectedStepIndex( Math.max( 0, newSteps.length - 1 ) );
		}
	};

	const addField = ( stepIndex ) => {
		const newSteps = [ ...steps ];
		if ( ! newSteps[ stepIndex ].fields ) {
			newSteps[ stepIndex ].fields = [];
		}
		newSteps[ stepIndex ].fields.push( {
			type: 'text',
			label: __( 'New Field', 'woo-product-calculator' ),
			name: 'field_' + Date.now(),
			required: false,
			options: [],
		} );
		setAttributes( { steps: newSteps } );
		setSelectedFieldIndex( newSteps[ stepIndex ].fields.length - 1 );
	};

	const updateField = ( stepIndex, fieldIndex, key, value ) => {
		const newSteps = [ ...steps ];
		newSteps[ stepIndex ].fields[ fieldIndex ][ key ] = value;
		setAttributes( { steps: newSteps } );
	};

	const removeField = ( stepIndex, fieldIndex ) => {
		const newSteps = [ ...steps ];
		newSteps[ stepIndex ].fields = newSteps[ stepIndex ].fields.filter( ( _, i ) => i !== fieldIndex );
		setAttributes( { steps: newSteps } );
		setSelectedFieldIndex( null );
	};

	const addFieldOption = ( stepIndex, fieldIndex ) => {
		const newSteps = [ ...steps ];
		if ( ! newSteps[ stepIndex ].fields[ fieldIndex ].options ) {
			newSteps[ stepIndex ].fields[ fieldIndex ].options = [];
		}
		newSteps[ stepIndex ].fields[ fieldIndex ].options.push( {
			label: __( 'Option', 'woo-product-calculator' ),
			value: 'option_' + Date.now(),
		} );
		setAttributes( { steps: newSteps } );
	};

	const updateFieldOption = ( stepIndex, fieldIndex, optionIndex, key, value ) => {
		const newSteps = [ ...steps ];
		newSteps[ stepIndex ].fields[ fieldIndex ].options[ optionIndex ][ key ] = value;
		setAttributes( { steps: newSteps } );
	};

	const removeFieldOption = ( stepIndex, fieldIndex, optionIndex ) => {
		const newSteps = [ ...steps ];
		newSteps[ stepIndex ].fields[ fieldIndex ].options = 
			newSteps[ stepIndex ].fields[ fieldIndex ].options.filter( ( _, i ) => i !== optionIndex );
		setAttributes( { steps: newSteps } );
	};

	const currentStep = steps[ selectedStepIndex ];
	const currentField = selectedFieldIndex !== null && currentStep?.fields?.[ selectedFieldIndex ];

	return (
		<>
			<InspectorControls>
				<PanelBody title={ __( 'Product Selection', 'woo-product-calculator' ) } initialOpen={ true }>
					<SelectControl
						label={ __( 'Linked Product', 'woo-product-calculator' ) }
						value={ productId }
						options={ productOptions }
						onChange={ ( value ) => setAttributes( { productId: parseInt( value ) } ) }
						help={ __( 'Select the WooCommerce product this calculator will add to cart', 'woo-product-calculator' ) }
					/>
					{ ! productId && (
						<Notice status="warning" isDismissible={ false }>
							{ __( 'Please select a product for this calculator to work properly.', 'woo-product-calculator' ) }
						</Notice>
					) }
					{ selectedProduct && (
						<div className="product-info">
							<p><strong>{ __( 'Selected:', 'woo-product-calculator' ) }</strong> { selectedProduct.title.rendered }</p>
						</div>
					) }
				</PanelBody>

				<PanelBody title={ __( 'Calculator Settings', 'woo-product-calculator' ) }>
					<TextControl
						label={ __( 'Calculator Title', 'woo-product-calculator' ) }
						value={ calculatorTitle }
						onChange={ ( value ) => setAttributes( { calculatorTitle: value } ) }
					/>
					<TextControl
						label={ __( 'Button Text', 'woo-product-calculator' ) }
						value={ buttonText }
						onChange={ ( value ) => setAttributes( { buttonText: value } ) }
					/>
				</PanelBody>

				<PanelBody title={ __( 'Price Calculation', 'woo-product-calculator' ) } initialOpen={ false }>
					<ToggleControl
						label={ __( 'Enable Price Calculation', 'woo-product-calculator' ) }
						checked={ priceCalculation.enabled }
						onChange={ ( value ) => setAttributes( { 
							priceCalculation: { ...priceCalculation, enabled: value } 
						} ) }
					/>
					{ priceCalculation.enabled && (
						<>
							<Notice status="info" isDismissible={ false }>
								{ __( 'Use field names in your formula. Example: width * height * quantity * 0.01', 'woo-product-calculator' ) }
							</Notice>
							<TextControl
								label={ __( 'Formula', 'woo-product-calculator' ) }
								value={ priceCalculation.formula }
								onChange={ ( value ) => setAttributes( { 
									priceCalculation: { ...priceCalculation, formula: value } 
								} ) }
								help={ __( 'Mathematical formula using field names', 'woo-product-calculator' ) }
							/>
						</>
					) }
				</PanelBody>

				<PanelBody title={ __( 'Steps', 'woo-product-calculator' ) } initialOpen={ true }>
					<div className="calculator-steps-list">
						{ steps.map( ( step, index ) => (
							<div 
								key={ index } 
								className={ `calculator-step-item ${ index === selectedStepIndex ? 'active' : '' }` }
								onClick={ () => setSelectedStepIndex( index ) }
							>
								<span>{ step.title }</span>
								<Button
									icon={ trash }
									isDestructive
									isSmall
									onClick={ ( e ) => {
										e.stopPropagation();
										removeStep( index );
									} }
								/>
							</div>
						) ) }
					</div>
					<Button
						icon={ plus }
						variant="secondary"
						onClick={ addStep }
						className="calculator-add-step"
					>
						{ __( 'Add Step', 'woo-product-calculator' ) }
					</Button>
				</PanelBody>

				{ currentStep && (
					<PanelBody title={ __( 'Step Settings', 'woo-product-calculator' ) } initialOpen={ true }>
						<TextControl
							label={ __( 'Step Title', 'woo-product-calculator' ) }
							value={ currentStep.title }
							onChange={ ( value ) => updateStep( selectedStepIndex, 'title', value ) }
						/>
						
						<div className="calculator-fields-list">
							<h4>{ __( 'Fields', 'woo-product-calculator' ) }</h4>
							{ currentStep.fields?.map( ( field, fieldIndex ) => (
								<div 
									key={ fieldIndex }
									className={ `calculator-field-item ${ fieldIndex === selectedFieldIndex ? 'active' : '' }` }
									onClick={ () => setSelectedFieldIndex( fieldIndex ) }
								>
									<span>{ field.label } ({ field.type })</span>
									<Button
										icon={ trash }
										isDestructive
										isSmall
										onClick={ ( e ) => {
											e.stopPropagation();
											removeField( selectedStepIndex, fieldIndex );
										} }
									/>
								</div>
							) ) }
						</div>
						
						<Button
							icon={ plus }
							variant="secondary"
							onClick={ () => addField( selectedStepIndex ) }
							className="calculator-add-field"
						>
							{ __( 'Add Field', 'woo-product-calculator' ) }
						</Button>
					</PanelBody>
				) }

				{ currentField && (
					<PanelBody title={ __( 'Field Settings', 'woo-product-calculator' ) } initialOpen={ true }>
						<SelectControl
							label={ __( 'Field Type', 'woo-product-calculator' ) }
							value={ currentField.type }
							options={ fieldTypes }
							onChange={ ( value ) => updateField( selectedStepIndex, selectedFieldIndex, 'type', value ) }
						/>
						<TextControl
							label={ __( 'Label', 'woo-product-calculator' ) }
							value={ currentField.label }
							onChange={ ( value ) => updateField( selectedStepIndex, selectedFieldIndex, 'label', value ) }
						/>
						<TextControl
							label={ __( 'Field Name', 'woo-product-calculator' ) }
							value={ currentField.name }
							onChange={ ( value ) => updateField( selectedStepIndex, selectedFieldIndex, 'name', value ) }
							help={ __( 'Used in formulas and cart data', 'woo-product-calculator' ) }
						/>
						<ToggleControl
							label={ __( 'Required', 'woo-product-calculator' ) }
							checked={ currentField.required }
							onChange={ ( value ) => updateField( selectedStepIndex, selectedFieldIndex, 'required', value ) }
						/>

						{ [ 'select', 'radio', 'checkbox' ].includes( currentField.type ) && (
							<>
								<h4>{ __( 'Options', 'woo-product-calculator' ) }</h4>
								{ currentField.options?.map( ( option, optionIndex ) => (
									<div key={ optionIndex } className="calculator-option-item">
										<TextControl
											label={ __( 'Label', 'woo-product-calculator' ) }
											value={ option.label }
											onChange={ ( value ) => updateFieldOption( selectedStepIndex, selectedFieldIndex, optionIndex, 'label', value ) }
										/>
										<TextControl
											label={ __( 'Value', 'woo-product-calculator' ) }
											value={ option.value }
											onChange={ ( value ) => updateFieldOption( selectedStepIndex, selectedFieldIndex, optionIndex, 'value', value ) }
										/>
										<Button
											icon={ trash }
											isDestructive
											isSmall
											onClick={ () => removeFieldOption( selectedStepIndex, selectedFieldIndex, optionIndex ) }
										>
											{ __( 'Remove', 'woo-product-calculator' ) }
										</Button>
									</div>
								) ) }
								<Button
									icon={ plus }
									variant="secondary"
									onClick={ () => addFieldOption( selectedStepIndex, selectedFieldIndex ) }
								>
									{ __( 'Add Option', 'woo-product-calculator' ) }
								</Button>
							</>
						) }

						{ currentField.type === 'number' && (
							<>
								<NumberControl
									label={ __( 'Min Value', 'woo-product-calculator' ) }
									value={ currentField.min }
									onChange={ ( value ) => updateField( selectedStepIndex, selectedFieldIndex, 'min', value ) }
								/>
								<NumberControl
									label={ __( 'Max Value', 'woo-product-calculator' ) }
									value={ currentField.max }
									onChange={ ( value ) => updateField( selectedStepIndex, selectedFieldIndex, 'max', value ) }
								/>
								<NumberControl
									label={ __( 'Step', 'woo-product-calculator' ) }
									value={ currentField.step }
									onChange={ ( value ) => updateField( selectedStepIndex, selectedFieldIndex, 'step', value ) }
								/>
							</>
						) }
					</PanelBody>
				) }
			</InspectorControls>

			<div { ...blockProps }>
				<div className="calculator-preview">
					<h3>{ calculatorTitle }</h3>
					{ ! productId && (
						<Notice status="warning" isDismissible={ false }>
							{ __( 'Please select a product in the block settings.', 'woo-product-calculator' ) }
						</Notice>
					) }
					{ selectedProduct && (
						<div className="selected-product-info">
							<p>{ __( 'Adding to cart:', 'woo-product-calculator' ) } <strong>{ selectedProduct.title.rendered }</strong></p>
						</div>
					) }
					<div className="calculator-steps-preview">
						{ steps.map( ( step, index ) => (
							<div 
								key={ index }
								className={ `step-indicator ${ index === selectedStepIndex ? 'active' : '' }` }
							>
								<span className="step-number">{ index + 1 }</span>
								<span className="step-title">{ step.title }</span>
							</div>
						) ) }
					</div>
					
					{ currentStep && (
						<div className="calculator-step-content">
							<h4>{ currentStep.title }</h4>
							{ currentStep.fields?.length > 0 ? (
								<div className="calculator-fields">
									{ currentStep.fields.map( ( field, index ) => (
										<div key={ index } className="calculator-field">
											<label>
												{ field.label }
												{ field.required && <span className="required">*</span> }
											</label>
											<div className="field-type-indicator">
												{ field.type }
											</div>
										</div>
									) ) }
								</div>
							) : (
								<p className="no-fields">
									{ __( 'No fields added yet. Add fields in the sidebar.', 'woo-product-calculator' ) }
								</p>
							) }
						</div>
					) }

					<div className="calculator-navigation">
						<Button variant="secondary" disabled={ selectedStepIndex === 0 }>
							{ __( 'Previous', 'woo-product-calculator' ) }
						</Button>
						<Button variant="primary">
							{ selectedStepIndex === steps.length - 1 ? buttonText : __( 'Next', 'woo-product-calculator' ) }
						</Button>
					</div>
				</div>
			</div>
		</>
	);
}
]]></content>
  </file>
  <file path="src/save.js">
    <description>This file contains the save function for the block which is responsible for creating the static result of rendering the block on the client to display the saved result on the front end.</description>
    <content><![CDATA[
]]></content>
  </file>
  <file path="src/style.scss">
    <description>This file contains styles for the block in the front end.</description>
    <content><![CDATA[
.wp-block-telex-woo-product-calculator {
	max-width: 800px;
	margin: 2rem auto;
	padding: 2rem;
	background: #fff;
	border-radius: 8px;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);

	.calculator-header {
		text-align: center;
		margin-bottom: 2rem;

		h2 {
			margin: 0 0 0.5rem;
			font-size: 2rem;
			color: #333;
		}
	}

	.calculator-progress {
		display: flex;
		justify-content: space-between;
		margin-bottom: 2rem;
		position: relative;

		&::before {
			content: '';
			position: absolute;
			top: 20px;
			left: 0;
			right: 0;
			height: 2px;
			background: #e0e0e0;
			z-index: 0;
		}

		.progress-line {
			position: absolute;
			top: 20px;
			left: 0;
			height: 2px;
			background: #0073aa;
			transition: width 0.3s ease;
			z-index: 1;
		}

		.step-indicator {
			display: flex;
			flex-direction: column;
			align-items: center;
			flex: 1;
			position: relative;
			z-index: 2;

			.step-circle {
				width: 40px;
				height: 40px;
				border-radius: 50%;
				background: #e0e0e0;
				display: flex;
				align-items: center;
				justify-content: center;
				font-weight: bold;
				transition: all 0.3s ease;
				margin-bottom: 0.5rem;
			}

			.step-title {
				font-size: 0.875rem;
				color: #666;
				text-align: center;
				max-width: 100px;
			}

			&.active .step-circle {
				background: #0073aa;
				color: #fff;
			}

			&.completed .step-circle {
				background: #46b450;
				color: #fff;
			}
		}
	}

	.calculator-content {
		min-height: 300px;
		margin-bottom: 2rem;

		.step-title {
			font-size: 1.5rem;
			margin-bottom: 1.5rem;
			color: #333;
		}

		.calculator-fields {
			display: grid;
			gap: 1.5rem;
		}

		.field-group {
			display: flex;
			flex-direction: column;

			label {
				font-weight: 600;
				margin-bottom: 0.5rem;
				color: #333;

				.required {
					color: #dc3232;
					margin-left: 0.25rem;
				}
			}

			input[type="text"],
			input[type="number"],
			select,
			textarea {
				padding: 0.75rem;
				border: 1px solid #ddd;
				border-radius: 4px;
				font-size: 1rem;
				transition: border-color 0.2s;

				&:focus {
					outline: none;
					border-color: #0073aa;
				}

				&.error {
					border-color: #dc3232;
				}
			}

			textarea {
				min-height: 100px;
				resize: vertical;
			}

			.radio-group,
			.checkbox-group {
				display: flex;
				flex-direction: column;
				gap: 0.5rem;

				label {
					display: flex;
					align-items: center;
					font-weight: normal;
					margin: 0;

					input {
						margin-right: 0.5rem;
					}
				}
			}

			.file-upload {
				border: 2px dashed #ddd;
				border-radius: 4px;
				padding: 2rem;
				text-align: center;
				cursor: pointer;
				transition: border-color 0.2s;

				&:hover,
				&.dragover {
					border-color: #0073aa;
				}

				.upload-icon {
					font-size: 3rem;
					color: #999;
					margin-bottom: 1rem;
				}

				.upload-text {
					margin-bottom: 0.5rem;
				}

				.file-info {
					font-size: 0.875rem;
					color: #666;
				}

				input[type="file"] {
					display: none;
				}

				&.has-file {
					border-color: #46b450;
					background: #f0f9f0;
				}
			}

			.error-message {
				color: #dc3232;
				font-size: 0.875rem;
				margin-top: 0.25rem;
			}
		}
	}

	.calculator-price {
		background: #f7f7f7;
		padding: 1.5rem;
		border-radius: 4px;
		margin-bottom: 2rem;
		text-align: center;

		.price-label {
			font-size: 1rem;
			color: #666;
			margin-bottom: 0.5rem;
		}

		.price-amount {
			font-size: 2rem;
			font-weight: bold;
			color: #0073aa;
		}
	}

	.calculator-navigation {
		display: flex;
		justify-content: space-between;
		gap: 1rem;

		button {
			flex: 1;
			padding: 1rem 2rem;
			font-size: 1rem;
			font-weight: 600;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			transition: all 0.2s;

			&.btn-secondary {
				background: #f7f7f7;
				color: #333;

				&:hover:not(:disabled) {
					background: #e0e0e0;
				}
			}

			&.btn-primary {
				background: #0073aa;
				color: #fff;

				&:hover:not(:disabled) {
					background: #005a87;
				}
			}

			&:disabled {
				opacity: 0.5;
				cursor: not-allowed;
			}
		}
	}

	.calculator-loading {
		text-align: center;
		padding: 2rem;

		.spinner {
			width: 40px;
			height: 40px;
			border: 4px solid #f3f3f3;
			border-top: 4px solid #0073aa;
			border-radius: 50%;
			animation: spin 1s linear infinite;
			margin: 0 auto 1rem;
		}
	}

	@keyframes spin {
		0% { transform: rotate(0deg); }
		100% { transform: rotate(360deg); }
	}

	.calculator-success {
		text-align: center;
		padding: 2rem;

		.success-icon {
			font-size: 4rem;
			color: #46b450;
			margin-bottom: 1rem;
		}

		h3 {
			margin-bottom: 1rem;
		}

		.view-cart-btn {
			display: inline-block;
			padding: 1rem 2rem;
			background: #0073aa;
			color: #fff;
			text-decoration: none;
			border-radius: 4px;
			font-weight: 600;
			transition: background 0.2s;

			&:hover {
				background: #005a87;
			}
		}
	}

	@media (max-width: 768px) {
		padding: 1rem;

		.calculator-progress {
			.step-title {
				font-size: 0.75rem;
				max-width: 60px;
			}

			.step-circle {
				width: 32px;
				height: 32px;
				font-size: 0.875rem;
			}
		}

		.calculator-navigation {
			flex-direction: column;

			button {
				width: 100%;
			}
		}
	}
}
]]></content>
  </file>
  <file path="src/editor.scss">
    <description>This file contains styles for the block in the editor.</description>
    <content><![CDATA[
.woo-calculator-editor {
	border: 1px solid #ddd;
	border-radius: 4px;
	background: #fff;

	.calculator-preview {
		padding: 2rem;

		h3 {
			margin-top: 0;
			text-align: center;
		}

		.selected-product-info {
			background: #f0f6fc;
			padding: 1rem;
			border-radius: 4px;
			margin-bottom: 1.5rem;
			text-align: center;

			p {
				margin: 0;
				font-size: 0.9rem;
			}
		}

		.calculator-steps-preview {
			display: flex;
			justify-content: center;
			gap: 1rem;
			margin-bottom: 2rem;
			flex-wrap: wrap;

			.step-indicator {
				display: flex;
				flex-direction: column;
				align-items: center;
				padding: 0.5rem;
				border-radius: 4px;
				transition: background 0.2s;

				&.active {
					background: #f0f6fc;
				}

				.step-number {
					width: 32px;
					height: 32px;
					border-radius: 50%;
					background: #e0e0e0;
					display: flex;
					align-items: center;
					justify-content: center;
					font-weight: bold;
					margin-bottom: 0.25rem;
				}

				.step-title {
					font-size: 0.875rem;
					text-align: center;
				}

				&.active .step-number {
					background: #0073aa;
					color: #fff;
				}
			}
		}

		.calculator-step-content {
			min-height: 200px;
			padding: 1.5rem;
			background: #f9f9f9;
			border-radius: 4px;
			margin-bottom: 1.5rem;

			h4 {
				margin-top: 0;
			}

			.calculator-fields {
				display: grid;
				gap: 1rem;

				.calculator-field {
					padding: 1rem;
					background: #fff;
					border: 1px solid #ddd;
					border-radius: 4px;

					label {
						display: block;
						font-weight: 600;
						margin-bottom: 0.5rem;

						.required {
							color: #dc3232;
						}
					}

					.field-type-indicator {
						display: inline-block;
						padding: 0.25rem 0.75rem;
						background: #0073aa;
						color: #fff;
						border-radius: 3px;
						font-size: 0.75rem;
						font-weight: 600;
						text-transform: uppercase;
					}
				}
			}

			.no-fields {
				text-align: center;
				color: #666;
				font-style: italic;
				padding: 2rem;
			}
		}

		.calculator-navigation {
			display: flex;
			justify-content: space-between;
			gap: 1rem;
		}
	}
}

.components-panel__body {
	.product-info {
		padding: 1rem;
		background: #f0f6fc;
		border-radius: 4px;
		margin-top: 1rem;

		p {
			margin: 0;
			font-size: 0.9rem;
		}
	}

	.calculator-steps-list,
	.calculator-fields-list {
		margin-bottom: 1rem;

		h4 {
			margin-top: 1rem;
			margin-bottom: 0.5rem;
		}

		.calculator-step-item,
		.calculator-field-item {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 0.75rem;
			margin-bottom: 0.5rem;
			background: #f9f9f9;
			border: 1px solid #ddd;
			border-radius: 4px;
			cursor: pointer;
			transition: all 0.2s;

			&:hover {
				background: #f0f0f0;
			}

			&.active {
				background: #0073aa;
				color: #fff;
				border-color: #0073aa;

				.components-button {
					color: #fff;

					&:hover {
						color: #dc3232;
					}
				}
			}

			span {
				flex: 1;
				font-weight: 500;
			}

			.components-button {
				margin-left: 0.5rem;
			}
		}
	}

	.calculator-add-step,
	.calculator-add-field {
		width: 100%;
		justify-content: center;
		margin-top: 0.5rem;
	}

	.calculator-option-item {
		padding: 1rem;
		margin-bottom: 1rem;
		background: #f9f9f9;
		border: 1px solid #ddd;
		border-radius: 4px;

		.components-base-control {
			margin-bottom: 0.5rem;
		}

		.components-button {
			margin-top: 0.5rem;
		}
	}

	.components-notice {
		margin-bottom: 1rem;
	}
}
]]></content>
  </file>
  <file path="src/view.js">
    <description>This file contains the view function for the block which is responsible for rendering interactive behaviors of the block on the front end.</description>
    <content><![CDATA[document.addEventListener('DOMContentLoaded', function() {
	if (typeof wooCalculatorData === 'undefined') {
		console.error('WooCommerce Calculator: Configuration data not loaded');
		return;
	}
	
	const calculators = document.querySelectorAll('.wp-block-telex-woo-product-calculator');
	
	calculators.forEach(function(calculator) {
		initCalculator(calculator);
	});
});

function initCalculator(calculator) {
	const stepsData = JSON.parse(calculator.dataset.steps || '[]');
	const priceCalculation = JSON.parse(calculator.dataset.priceCalculation || '{"enabled":false}');
	const productId = calculator.dataset.productId || 0;
	
	let currentStep = 0;
	let formData = {};
	let uploadedFiles = {};
	
	const contentArea = calculator.querySelector('.calculator-content');
	const prevButton = calculator.querySelector('.btn-previous');
	const nextButton = calculator.querySelector('.btn-next');
	const priceDisplay = calculator.querySelector('.calculator-price');
	
	function renderStep(stepIndex) {
		const step = stepsData[stepIndex];
		if (!step) return;
		
		currentStep = stepIndex;
		
		// Update progress indicators
		const indicators = calculator.querySelectorAll('.step-indicator');
		indicators.forEach(function(indicator, index) {
			indicator.classList.remove('active', 'completed');
			if (index === stepIndex) {
				indicator.classList.add('active');
			} else if (index < stepIndex) {
				indicator.classList.add('completed');
			}
		});
		
		// Update progress line
		const progressLine = calculator.querySelector('.progress-line');
		if (progressLine) {
			const progress = (stepIndex / (stepsData.length - 1)) * 100;
			progressLine.style.width = progress + '%';
		}
		
		// Render fields
		let html = '<h3 class="step-title">' + escapeHtml(step.title) + '</h3>';
		html += '<div class="calculator-fields">';
		
		step.fields.forEach(function(field) {
			html += renderField(field);
		});
		
		html += '</div>';
		contentArea.innerHTML = html;
		
		// Attach event listeners
		attachFieldListeners(step.fields);
		
		// Update navigation buttons
		updateNavigation();
		
		// Update price if enabled
		if (priceCalculation.enabled) {
			updatePrice();
		}
	}
	
	function renderField(field) {
		const value = formData[field.name] || '';
		const required = field.required ? '<span class="required">*</span>' : '';
		
		let html = '<div class="field-group" data-field-name="' + field.name + '">';
		html += '<label>' + escapeHtml(field.label) + required + '</label>';
		
		switch(field.type) {
			case 'text':
			case 'number':
				const inputType = field.type;
				const min = field.min ? ' min="' + field.min + '"' : '';
				const max = field.max ? ' max="' + field.max + '"' : '';
				const step = field.step ? ' step="' + field.step + '"' : '';
				html += '<input type="' + inputType + '" name="' + field.name + '" value="' + escapeHtml(value) + '"' + min + max + step + ' />';
				break;
				
			case 'textarea':
				html += '<textarea name="' + field.name + '">' + escapeHtml(value) + '</textarea>';
				break;
				
			case 'select':
				html += '<select name="' + field.name + '">';
				html += '<option value="">Select an option</option>';
				(field.options || []).forEach(function(option) {
					const selected = value === option.value ? ' selected' : '';
					html += '<option value="' + escapeHtml(option.value) + '"' + selected + '>' + escapeHtml(option.label) + '</option>';
				});
				html += '</select>';
				break;
				
			case 'radio':
				html += '<div class="radio-group">';
				(field.options || []).forEach(function(option) {
					const checked = value === option.value ? ' checked' : '';
					html += '<label><input type="radio" name="' + field.name + '" value="' + escapeHtml(option.value) + '"' + checked + ' /> ' + escapeHtml(option.label) + '</label>';
				});
				html += '</div>';
				break;
				
			case 'checkbox':
				html += '<div class="checkbox-group">';
				(field.options || []).forEach(function(option) {
					const checked = Array.isArray(value) && value.includes(option.value) ? ' checked' : '';
					html += '<label><input type="checkbox" name="' + field.name + '[]" value="' + escapeHtml(option.value) + '"' + checked + ' /> ' + escapeHtml(option.label) + '</label>';
				});
				html += '</div>';
				break;
				
			case 'file':
				const fileName = uploadedFiles[field.name] ? uploadedFiles[field.name].name : 'No file chosen';
				const hasFile = uploadedFiles[field.name] ? ' has-file' : '';
				html += '<div class="file-upload' + hasFile + '" data-field="' + field.name + '">';
				html += '<div class="upload-icon">üìÅ</div>';
				html += '<div class="upload-text">Click to upload or drag and drop</div>';
				html += '<div class="file-info">Accepted: PDF, PNG, JPG, AI, EPS (Max 10MB)</div>';
				html += '<div class="file-name">' + fileName + '</div>';
				html += '<input type="file" name="' + field.name + '" accept=".pdf,.png,.jpg,.jpeg,.ai,.eps" />';
				html += '</div>';
				break;
		}
		
		html += '<div class="error-message"></div>';
		html += '</div>';
		
		return html;
	}
	
	function attachFieldListeners(fields) {
		fields.forEach(function(field) {
			const fieldElement = contentArea.querySelector('[data-field-name="' + field.name + '"]');
			if (!fieldElement) return;
			
			if (field.type === 'file') {
				const fileUpload = fieldElement.querySelector('.file-upload');
				const fileInput = fieldElement.querySelector('input[type="file"]');
				
				fileUpload.addEventListener('click', function() {
					fileInput.click();
				});
				
				fileInput.addEventListener('change', function(e) {
					handleFileUpload(e.target, field.name);
				});
				
				// Drag and drop
				fileUpload.addEventListener('dragover', function(e) {
					e.preventDefault();
					fileUpload.classList.add('dragover');
				});
				
				fileUpload.addEventListener('dragleave', function() {
					fileUpload.classList.remove('dragover');
				});
				
				fileUpload.addEventListener('drop', function(e) {
					e.preventDefault();
					fileUpload.classList.remove('dragover');
					fileInput.files = e.dataTransfer.files;
					handleFileUpload(fileInput, field.name);
				});
			} else if (field.type === 'checkbox') {
				const checkboxes = fieldElement.querySelectorAll('input[type="checkbox"]');
				checkboxes.forEach(function(checkbox) {
					checkbox.addEventListener('change', function() {
						const values = Array.from(checkboxes)
							.filter(cb => cb.checked)
							.map(cb => cb.value);
						formData[field.name] = values;
						if (priceCalculation.enabled) {
							updatePrice();
						}
					});
				});
			} else {
				const input = fieldElement.querySelector('input, select, textarea');
				if (input) {
					input.addEventListener('change', function() {
						formData[field.name] = this.value;
						clearError(field.name);
						if (priceCalculation.enabled) {
							updatePrice();
						}
					});
				}
			}
		});
	}
	
	function handleFileUpload(input, fieldName) {
		const file = input.files[0];
		if (!file) return;
		
		// Validate file
		const allowedTypes = ['application/pdf', 'image/png', 'image/jpeg', 'image/jpg'];
		const maxSize = 10 * 1024 * 1024; // 10MB
		
		if (!allowedTypes.includes(file.type) && !file.name.match(/\.(ai|eps)$/i)) {
			showError(fieldName, 'Invalid file type. Please upload PDF, PNG, JPG, AI, or EPS.');
			return;
		}
		
		if (file.size > maxSize) {
			showError(fieldName, 'File size exceeds 10MB limit.');
			return;
		}
		
		// Show loading
		const fileUpload = input.closest('.file-upload');
		fileUpload.classList.add('uploading');
		
		// Upload file via AJAX
		const uploadData = new FormData();
		uploadData.append('file', file);
		uploadData.append('action', 'woo_calculator_upload_file');
		uploadData.append('nonce', wooCalculatorData.nonce);
		
		fetch(wooCalculatorData.ajaxUrl, {
			method: 'POST',
			body: uploadData
		})
		.then(response => response.json())
		.then(data => {
			fileUpload.classList.remove('uploading');
			if (data.success) {
				uploadedFiles[fieldName] = {
					name: file.name,
					url: data.data.url
				};
				fileUpload.classList.add('has-file');
				fileUpload.querySelector('.file-name').textContent = file.name;
				formData[fieldName] = data.data.url;
				clearError(fieldName);
			} else {
				showError(fieldName, data.data.message || 'Upload failed');
			}
		})
		.catch(error => {
			fileUpload.classList.remove('uploading');
			showError(fieldName, 'Upload failed. Please try again.');
		});
	}
	
	function validateStep(stepIndex) {
		const step = stepsData[stepIndex];
		let isValid = true;
		
		step.fields.forEach(function(field) {
			if (field.required) {
				const value = formData[field.name];
				if (!value || (Array.isArray(value) && value.length === 0)) {
					showError(field.name, 'This field is required');
					isValid = false;
				}
			}
		});
		
		return isValid;
	}
	
	function showError(fieldName, message) {
		const fieldElement = contentArea.querySelector('[data-field-name="' + fieldName + '"]');
		if (fieldElement) {
			const input = fieldElement.querySelector('input, select, textarea');
			if (input) {
				input.classList.add('error');
			}
			const errorElement = fieldElement.querySelector('.error-message');
			if (errorElement) {
				errorElement.textContent = message;
			}
		}
	}
	
	function clearError(fieldName) {
		const fieldElement = contentArea.querySelector('[data-field-name="' + fieldName + '"]');
		if (fieldElement) {
			const input = fieldElement.querySelector('input, select, textarea');
			if (input) {
				input.classList.remove('error');
			}
			const errorElement = fieldElement.querySelector('.error-message');
			if (errorElement) {
				errorElement.textContent = '';
			}
		}
	}
	
	function updateNavigation() {
		prevButton.disabled = currentStep === 0;
		
		if (currentStep === stepsData.length - 1) {
			nextButton.textContent = calculator.dataset.buttonText || 'Add to Cart';
		} else {
			nextButton.textContent = 'Next';
		}
	}
	
	function updatePrice() {
		if (!priceCalculation.enabled || !priceCalculation.formula) return;
		
		try {
			// Replace field names with values in formula
			let formula = priceCalculation.formula;
			Object.keys(formData).forEach(function(key) {
				const value = parseFloat(formData[key]) || 0;
				formula = formula.replace(new RegExp(key, 'g'), value);
			});
			
			// Evaluate formula (simple math only)
			const price = eval(formula);
			
			if (priceDisplay && !isNaN(price)) {
				priceDisplay.querySelector('.price-amount').textContent = '$' + price.toFixed(2);
			}
		} catch (error) {
			console.error('Price calculation error:', error);
		}
	}
	
	function submitCalculator() {
		// Show loading
		contentArea.innerHTML = '<div class="calculator-loading"><div class="spinner"></div><p>Adding to cart...</p></div>';
		
		// Submit to cart via AJAX
		const data = new FormData();
		data.append('action', 'woo_calculator_add_to_cart');
		data.append('nonce', wooCalculatorData.nonce);
		data.append('product_id', productId);
		data.append('quantity', formData.quantity || 1);
		data.append('calculator_data', JSON.stringify(formData));
		
		fetch(wooCalculatorData.ajaxUrl, {
			method: 'POST',
			body: data
		})
		.then(response => response.json())
		.then(result => {
			if (result.success) {
				contentArea.innerHTML = '<div class="calculator-success"><div class="success-icon">‚úì</div><h3>Added to Cart!</h3><p>' + result.data.message + '</p><a href="' + result.data.cart_url + '" class="view-cart-btn">View Cart</a></div>';
				// Update cart count if mini cart exists
				if (result.data.cart_count) {
					const cartCounts = document.querySelectorAll('.cart-contents-count');
					cartCounts.forEach(el => el.textContent = result.data.cart_count);
				}
			} else {
				contentArea.innerHTML = '<div class="calculator-error"><p>Error: ' + result.data.message + '</p><button class="btn-primary btn-retry">Try Again</button></div>';
				const retryButton = contentArea.querySelector('.btn-retry');
				retryButton.addEventListener('click', function() {
					renderStep(currentStep);
				});
			}
		})
		.catch(error => {
			contentArea.innerHTML = '<div class="calculator-error"><p>An error occurred. Please try again.</p><button class="btn-primary btn-retry">Try Again</button></div>';
			const retryButton = contentArea.querySelector('.btn-retry');
			retryButton.addEventListener('click', function() {
				renderStep(currentStep);
			});
		});
	}
	
	// Navigation event listeners
	prevButton.addEventListener('click', function() {
		if (currentStep > 0) {
			renderStep(currentStep - 1);
		}
	});
	
	nextButton.addEventListener('click', function() {
		if (!validateStep(currentStep)) {
			return;
		}
		
		if (currentStep < stepsData.length - 1) {
			renderStep(currentStep + 1);
		} else {
			submitCalculator();
		}
	});
	
	// Initialize first step
	renderStep(0);
}

function escapeHtml(text) {
	const div = document.createElement('div');
	div.textContent = text;
	return div.innerHTML;
}]]></content>
  </file>
  <file path="src/render.php">
    <description>This file contains the render callback function for the block, which is responsible for rendering the block content on the front end.</description>
    <content><![CDATA[<?php
/**
 * Render callback for the WooCommerce Product Calculator block
 *
 * @param array $attributes Block attributes
 * @return string Block HTML
 */

if ( ! defined( 'ABSPATH' ) ) {
	exit;
}

$calculator_title = isset( $attributes['calculatorTitle'] ) ? $attributes['calculatorTitle'] : __( 'Configure Your Product', 'woo-product-calculator' );
$steps = isset( $attributes['steps'] ) ? $attributes['steps'] : array();
$price_calculation = isset( $attributes['priceCalculation'] ) ? $attributes['priceCalculation'] : array( 'enabled' => false );
$button_text = isset( $attributes['buttonText'] ) ? $attributes['buttonText'] : __( 'Add to Cart', 'woo-product-calculator' );
$product_id = isset( $attributes['productId'] ) ? absint( $attributes['productId'] ) : 0;

// If no product selected, show error message
if ( ! $product_id ) {
	return '<div class="woo-calculator-error"><p>' . esc_html__( 'Please configure a product for this calculator in the block settings.', 'woo-product-calculator' ) . '</p></div>';
}

// Verify product exists
$product = wc_get_product( $product_id );
if ( ! $product ) {
	return '<div class="woo-calculator-error"><p>' . esc_html__( 'The selected product could not be found.', 'woo-product-calculator' ) . '</p></div>';
}

$wrapper_attributes = get_block_wrapper_attributes( array(
	'class' => 'wp-block-telex-woo-product-calculator',
	'data-steps' => esc_attr( wp_json_encode( $steps ) ),
	'data-price-calculation' => esc_attr( wp_json_encode( $price_calculation ) ),
	'data-product-id' => esc_attr( $product_id ),
	'data-button-text' => esc_attr( $button_text ),
) );

ob_start();
?>

<div <?php echo $wrapper_attributes; ?>>
	<div class="calculator-header">
		<h2><?php echo esc_html( $calculator_title ); ?></h2>
		<div class="product-reference">
			<p><?php echo esc_html__( 'Configuring:', 'woo-product-calculator' ); ?> <strong><?php echo esc_html( $product->get_name() ); ?></strong></p>
		</div>
	</div>

	<div class="calculator-progress">
		<div class="progress-line" style="width: 0%;"></div>
		<?php foreach ( $steps as $index => $step ) : ?>
			<div class="step-indicator" data-step="<?php echo esc_attr( $index ); ?>">
				<div class="step-circle"><?php echo esc_html( $index + 1 ); ?></div>
				<div class="step-title"><?php echo esc_html( $step['title'] ); ?></div>
			</div>
		<?php endforeach; ?>
	</div>

	<div class="calculator-content">
		<p><?php esc_html_e( 'Loading calculator...', 'woo-product-calculator' ); ?></p>
	</div>

	<?php if ( ! empty( $price_calculation['enabled'] ) ) : ?>
		<div class="calculator-price">
			<div class="price-label"><?php esc_html_e( 'Estimated Price:', 'woo-product-calculator' ); ?></div>
			<div class="price-amount">$0.00</div>
		</div>
	<?php endif; ?>

	<div class="calculator-navigation">
		<button type="button" class="btn-secondary btn-previous">
			<?php esc_html_e( 'Previous', 'woo-product-calculator' ); ?>
		</button>
		<button type="button" class="btn-primary btn-next">
			<?php esc_html_e( 'Next', 'woo-product-calculator' ); ?>
		</button>
	</div>
</div>

<?php
return ob_get_clean();]]></content>
  </file>
</artefact>